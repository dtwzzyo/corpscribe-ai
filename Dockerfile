# Шаг 1: Выбираем базовый "образ" - официальный Python 3.9
# Это как выбрать фундамент для нашего дома.
FROM python:3.9-slim

# Шаг 2: Устанавливаем рабочую директорию внутри контейнера.
# Все последующие команды будут выполняться в /app.
WORKDIR /app

# Шаг 3: Копируем "список запчастей" в контейнер.
# Копируем сначала только его для оптимизации кеширования слоев Docker. Про-фишка!
COPY requirements.txt .

# Шаг 4: Устанавливаем все наши Python-библиотеки.
RUN pip install --no-cache-dir -r requirements.txt

# Шаг 5: Копируем весь остальной код нашего проекта в контейнер.
COPY . .

# Шаг 6: Сообщаем Docker, что наше приложение будет слушать два порта.
# 5001 для Flask API и 8501 для Streamlit UI.
EXPOSE 5001
EXPOSE 8501

# Шаг 7: Команда, которая будет запущена при старте контейнера.
# Мы запускаем Flask API в фоновом режиме (&), а затем запускаем Streamlit UI.
CMD ["/bin/bash", "-c", "python app.py & streamlit run ui.py --server.port 8501 --server.address 0.0.0.0"]
